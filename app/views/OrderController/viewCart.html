#{extends 'main.html' /}
#{set title:'Mi Carrito - BYCar' /}

<div class="cart-container">
    <!-- Header del Carrito -->
    <div class="cart-header animate-in">
        <h1>Mi Carrito</h1>
        #{if car}
            <p class="cart-count">1 vehículo</p>
        #{/if}
        #{else}
            <p class="cart-count">Carrito vacío</p>
        #{/else}
    </div>

    <!-- Mensajes Flash -->
    #{if flash.error}
        <div class="alert alert-danger animate-fade">
            ${flash.error}
        </div>
    #{/if}

    #{if flash.success}
        <div class="alert alert-success animate-fade">
            ${flash.success}
        </div>
    #{/if}

    #{if car}
        <!-- Estado CON coche -->
        <div class="cart-content animate-in">
            <div class="cart-item-section">
                <!-- Card del Coche -->
                <div class="cart-item">
                    <div class="cart-item-image">
                        <img src="${car.foto1}" alt="${car.marca} ${car.modelo}">
                    </div>
                    <div class="cart-item-details">
                        <div class="cart-item-header">
                            <span class="cart-item-brand">${car.marca}</span>
                            <h2 class="cart-item-model">${car.modelo}</h2>
                            #{if car.version}
                                <p class="cart-item-version">${car.version}</p>
                            #{/if}
                        </div>
                        <div class="cart-item-specs">
                            <span class="spec">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                ${car.year}
                            </span>
                            #{if car.combustible}
                                <span class="spec">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 22V6c0-1.1.9-2 2-2h6c1.1 0 2 .9 2 2v16"/>
                                        <path d="M13 10h4c1.1 0 2 .9 2 2v8c0 1.1-.9 2-2 2"/>
                                        <circle cx="8" cy="18" r="2"/>
                                    </svg>
                                    ${car.combustible}
                                </span>
                            #{/if}
                            #{if car.potencia}
                                <span class="spec">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                    </svg>
                                    ${car.potencia}
                                </span>
                            #{/if}
                        </div>
                        <div class="cart-item-price">
                            ${car.precio.format('###,###').replace(',', '.')} &euro;
                        </div>
                        <form id="removeFromCartForm" action="@{OrderController.removeFromCart()}" method="POST" class="cart-item-actions">
                            <button type="button" class="btn-remove-cart" onclick="showDeleteModal()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                Eliminar
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Resumen del Carrito -->
            <div class="cart-summary-section">
                <div class="cart-summary">
                    <h3>Resumen del pedido</h3>
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span>${car.precio.format('###,###').replace(',', '.')} &euro;</span>
                    </div>
                    <div class="summary-row">
                        <span>Impuestos incluidos</span>
                        <span>IVA 21%</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-row summary-total">
                        <span>Total</span>
                        <span>${car.precio.format('###,###').replace(',', '.')} &euro;</span>
                    </div>
                    <a href="@{OrderController.checkout()}" class="btn-checkout">
                        Proceder al Checkout
                    </a>
                    <a href="@{CarController.catalog()}" class="btn-continue-shopping">
                        Seguir comprando
                    </a>
                </div>
            </div>
        </div>
    #{/if}
    #{else}
        <!-- Estado VACÍO -->
        <div class="cart-empty animate-in">
            <div class="cart-empty-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="9" cy="21" r="1"/>
                    <circle cx="20" cy="21" r="1"/>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                </svg>
            </div>
            <h2>Tu carrito está vacío</h2>
            <p>Explora nuestro catálogo de vehículos de lujo y encuentra el tuyo</p>
            <a href="@{CarController.catalog()}" class="premium-btn">
                Explorar Catálogo
            </a>
        </div>
    #{/else}
</div>

<!-- Modal Eliminar del Carrito -->
<div class="modal-overlay" id="deleteCartModal">
    <div class="modal-container">
        <div class="modal-header">
            <h3 class="modal-title">Eliminar del Carrito</h3>
            <button type="button" class="modal-close" onclick="hideDeleteModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="modal-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    <line x1="10" y1="11" x2="10" y2="17"/>
                    <line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
            </div>
            <p>¿Estás seguro de que deseas eliminar este vehículo del carrito?</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-modal-cancel" onclick="hideDeleteModal()">
                Cancelar
            </button>
            <button type="button" class="btn-modal-confirm" onclick="confirmDelete()">
                Eliminar
            </button>
        </div>
    </div>
</div>

<script>
function showDeleteModal() {
    document.getElementById('deleteCartModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function hideDeleteModal() {
    document.getElementById('deleteCartModal').classList.remove('active');
    document.body.style.overflow = '';
}

function confirmDelete() {
    document.getElementById('removeFromCartForm').submit();
}

// Cerrar modal al hacer click fuera
document.getElementById('deleteCartModal').addEventListener('click', function(e) {
    if (e.target === this) {
        hideDeleteModal();
    }
});

// Cerrar modal con tecla Escape
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        hideDeleteModal();
    }
});
</script>
