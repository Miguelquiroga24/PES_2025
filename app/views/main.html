<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="${_response_encoding}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="BYCar - Concesionario de Vehiculos de Lujo">

    <title>#{get 'title' /}</title>

    <!-- Favicon simple -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3C/svg%3E">

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap 5.3.2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS Premium Personalizado -->
    <link rel="stylesheet" href="@{'/public/stylesheets/main.css'}">

    #{get 'moreStyles' /}
</head>
<body>
    <!-- Canvas de fondo para particulas -->
    <canvas id="bgCanvas"></canvas>

    <!-- Navbar Premium -->
    <nav class="navbar-premium">
        <div class="container-fluid">
            <a href="@{Application.index()}" class="brand">
                <span class="brand-text">BYCar</span>
            </a>

            <!-- Mobile Menu Toggle -->
            <div class="menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <div class="nav-links">
                <!-- Inicio -->
                <a href="@{Application.index()}" class="nav-icon-link" data-tooltip="Inicio">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span class="nav-tooltip">Inicio</span>
                </a>

                <!-- Catalogo -->
                <a href="@{CarController.catalog()}" class="nav-icon-link" data-tooltip="Catalogo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span class="nav-tooltip">Catalogo</span>
                </a>

                #{if session.get("userId")}
                    <!-- Usuario logueado -->

                    <!-- Favoritos -->
                    <a href="@{FavoriteController.index()}" class="nav-icon-link nav-favorites" data-tooltip="Favoritos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                        <span class="favorite-count-badge" style="display: none;">0</span>
                        <span class="nav-tooltip">Favoritos</span>
                    </a>

                    <!-- Carrito -->
                    <a href="@{OrderController.viewCart()}" class="nav-icon-link nav-cart" data-tooltip="Carrito">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        <span class="cart-count-badge" #{if !session.get('cartCarId')}style="display: none;"#{/if}>1</span>
                        <span class="nav-tooltip">Carrito</span>
                    </a>

                    <!-- Pedidos -->
                    <a href="@{OrderController.history()}" class="nav-icon-link nav-history" data-tooltip="Pedidos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                        <span class="nav-tooltip">Pedidos</span>
                    </a>

                    <!-- Mi Perfil -->
                    <a href="@{UserController.profile()}" class="nav-icon-link" data-tooltip="Mi Perfil">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span class="nav-tooltip">Mi Perfil</span>
                    </a>

                    %{
                        // Obtener usuario actual para verificar si es admin
                        models.User currentUserNav = null;
                        if (session.get("userId") != null) {
                            try {
                                currentUserNav = models.User.findById(Long.parseLong(session.get("userId")));
                            } catch (Exception e) {}
                        }
                    }%
                    #{if currentUserNav?.isAdmin}
                        <!-- Admin Panel -->
                        <a href="@{AdminController.dashboard()}" class="nav-icon-link nav-admin" data-tooltip="Admin">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                            <span class="nav-tooltip">Admin</span>
                        </a>
                    #{/if}

                    <!-- Cerrar Sesion -->
                    <a href="@{UserController.logout()}" class="nav-icon-link nav-logout" data-tooltip="Salir">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        <span class="nav-tooltip">Salir</span>
                    </a>
                #{/if}
                #{else}
                    <!-- Usuario NO logueado -->
                    <a href="@{UserController.login()}" class="nav-icon-link" data-tooltip="Iniciar Sesion">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                            <polyline points="10 17 15 12 10 7"></polyline>
                            <line x1="15" y1="12" x2="3" y2="12"></line>
                        </svg>
                        <span class="nav-tooltip">Iniciar Sesion</span>
                    </a>
                    <a href="@{UserController.register()}" class="nav-icon-link nav-register" data-tooltip="Registrarse">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                        <span class="nav-tooltip">Registrarse</span>
                    </a>
                #{/else}
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="main-content">
        #{doLayout /}
    </main>

    <!-- Footer Premium -->
    <footer class="footer-premium">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-5">
                    <p class="mb-0">
                        <span class="footer-brand">BYCar</span> - Concesionario de Vehiculos de Lujo
                    </p>
                </div>
                <div class="col-md-4 text-center footer-center-col">
                    <button type="button" class="credits-btn" data-bs-toggle="modal" data-bs-target="#creditsModal">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4"/>
                            <circle cx="12" cy="8" r="0.5" fill="currentColor"/>
                        </svg>
                        Sobre la web
                    </button>
                </div>
                <div class="col-md-3 text-end">
                    <p class="mb-0">2025 Tots els drets reservats.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de Creditos -->
    <div class="modal fade" id="creditsModal" tabindex="-1" aria-labelledby="creditsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content credits-modal-content">
                <div class="modal-header credits-modal-header">
                    <h5 class="modal-title" id="creditsModalLabel">
                        Crédits
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Tancar"></button>
                </div>
                <div class="modal-body credits-modal-body">
                    <div class="credits-item">
                        <span class="credits-label">Creadors</span>
                        <span class="credits-value">Maria Cazorla Galindo i Miguel Ángel Quiroga Herrera</span>
                    </div>
                    <div class="credits-item">
                        <span class="credits-label">Assignatura</span>
                        <span class="credits-value">Projecte d'Enginyeria del Software</span>
                    </div>
                    <div class="credits-item">
                        <span class="credits-label">Professora</span>
                        <span class="credits-value">Maria Dolores Royo Valles</span>
                    </div>
                    <div class="credits-item">
                        <span class="credits-label">Curs</span>
                        <span class="credits-value">Quadrimestre de Tardor, 2025-2026</span>
                    </div>
                </div>
                <div class="modal-footer credits-modal-footer">
                    <button type="button" class="credits-close-btn" data-bs-dismiss="modal">Tancar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5.3.2 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JS Premium Personalizado -->
    <script src="@{'/public/javascripts/main.js'}"></script>

    <!-- Sistema de Favoritos -->
    <script src="@{'/public/javascripts/favorites.js'}"></script>

    <!-- Sistema de Carrito -->
    <script src="@{'/public/javascripts/cart.js'}"></script>

    <!-- Sistema de Comparacion -->
    <script src="@{'/public/javascripts/compare.js'}"></script>

    #{get 'moreScripts' /}
</body>
</html>
